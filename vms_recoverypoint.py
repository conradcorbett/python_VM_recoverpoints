import logging
import json
import requests
import sys
import time
import traceback

from requests.auth import HTTPBasicAuth
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

url = "https://10.42.42.40:9440/api/nutanix/v3/graphql"

payload="{\"query\":\"{  totalRecoveryPointsQuery :\\n            groups\\n            (param_body:{entity_type:\\\"vm_recovery_point\\\",query_name:\\\"eb:data-1654214270286\\\",grouping_attribute:\\\"entity_uuid\\\",group_sort_attribute:\\\"entity_uuid\\\",group_sort_order:\\\"DESCENDING\\\",group_count:20,group_offset:0,group_attributes:[],group_member_count:1,group_member_offset:0,group_member_sort_attribute:\\\"creation_time_usecs\\\",group_member_sort_order:\\\"DESCENDING\\\",group_member_attributes:[{attribute:\\\"owner_name\\\"},{attribute:\\\"owner_reference\\\"},{attribute:\\\"categories\\\"},{attribute:\\\"source_cluster_uuid\\\"},{attribute:\\\"hypervisor_type\\\"},{attribute:\\\"_entity_id_\\\"},{attribute:\\\"creation_time_usecs\\\"},{attribute:\\\"entity_name\\\"}],availability_zone_scope:\\\"GLOBAL\\\"})\\n            {\\n              entity_type\\n              total_entity_count\\n              filtered_entity_count\\n              total_group_count\\n              filtered_group_count\\n              group_results\\n              {\\n                total_entity_count\\n                group_by_column_value\\n                    @export_to_filter(field: \\\"entity_uuid\\\", as: \\\"uuid\\\")\\n                entity_results\\n                  {data\\n                    {name\\n                      values\\n                      {values}\\n                    }\\n                  }\\n              }\\n            } latestRecoveryPointQuery :\\n            groups\\n            (param_body:{entity_type:\\\"vm_recovery_point\\\",query_name:\\\"eb:data-1654214270286\\\",grouping_attribute:\\\"entity_uuid\\\",group_sort_attribute:\\\"entity_uuid\\\",group_sort_order:\\\"DESCENDING\\\",group_count:20,group_offset:0,group_attributes:[],group_member_count:1,group_member_offset:0,group_member_sort_attribute:\\\"creation_time_usecs\\\",group_member_sort_order:\\\"DESCENDING\\\",group_member_attributes:[{attribute:\\\"source_pc_cluster_uuid\\\"},{attribute:\\\"source_cluster_uuid\\\"},{attribute:\\\"_entity_id_\\\"},{attribute:\\\"creation_time_usecs\\\"},{attribute:\\\"entity_name\\\"}],availability_zone_scope:\\\"LOCAL\\\",filter_criteria:\\\"$uuid\\\"})\\n            { entity_type\\n          total_entity_count\\n          filtered_entity_count\\n          total_group_count\\n          filtered_group_count\\n          group_results\\n          { total_entity_count\\n            group_by_column_value\\n            entity_results\\n              {data\\n                {name\\n                  values\\n                  {values}\\n                }\\n              }\\n            }\\n          } oldestRecoveryPointQuery :\\n            groups\\n            (param_body:{entity_type:\\\"vm_recovery_point\\\",query_name:\\\"eb:data-1654214270286\\\",grouping_attribute:\\\"entity_uuid\\\",group_sort_attribute:\\\"entity_uuid\\\",group_sort_order:\\\"DESCENDING\\\",group_count:20,group_offset:0,group_attributes:[],group_member_count:1,group_member_offset:0,group_member_sort_attribute:\\\"creation_time_usecs\\\",group_member_sort_order:\\\"ASCENDING\\\",group_member_attributes:[{attribute:\\\"source_pc_cluster_uuid\\\"},{attribute:\\\"source_cluster_uuid\\\"},{attribute:\\\"_entity_id_\\\"},{attribute:\\\"creation_time_usecs\\\"},{attribute:\\\"entity_name\\\"}],availability_zone_scope:\\\"LOCAL\\\",filter_criteria:\\\"snapshot_type\\\\n                    !=LIVE;$uuid\\\"})\\n            { entity_type\\n          total_entity_count\\n          filtered_entity_count\\n          total_group_count\\n          filtered_group_count\\n          group_results\\n          { total_entity_count\\n            group_by_column_value\\n            entity_results\\n              {data\\n                {name\\n                  values\\n                  {values}\\n                }\\n              }\\n            }\\n          } liveSnapShotsQuery :\\n            groups\\n            (param_body:{entity_type:\\\"vm_recovery_point\\\",query_name:\\\"eb:data-1654214270286\\\",grouping_attribute:\\\"entity_uuid\\\",group_sort_attribute:\\\"entity_uuid\\\",group_sort_order:\\\"DESCENDING\\\",group_count:1000,group_offset:0,group_attributes:[],group_member_count:1,group_member_offset:0,group_member_sort_attribute:\\\"creation_time_usecs\\\",group_member_sort_order:\\\"ASCENDING\\\",group_member_attributes:[{attribute:\\\"_entity_id_\\\"},{attribute:\\\"creation_time_usecs\\\"},{attribute:\\\"entity_name\\\"}],availability_zone_scope:\\\"LOCAL\\\",filter_criteria:\\\"snapshot_type\\\\n                    ==LIVE;$uuid\\\"})\\n            { entity_type\\n          total_entity_count\\n          filtered_entity_count\\n          total_group_count\\n          filtered_group_count\\n          group_results\\n          { total_entity_count\\n            group_by_column_value\\n            entity_results\\n              {data\\n                {name\\n                  values\\n                  {values}\\n                }\\n              }\\n            }\\n          } azNameQuery :\\n            groups\\n            (param_body:{entity_type:\\\"availability_zone\\\",availability_zone_scope:\\\"GLOBAL\\\",group_member_attributes:[{attribute:\\\"name\\\"},{attribute:\\\"url\\\"}],grouping_attribute:\\\"url\\\"})\\n            { entity_type\\n          total_entity_count\\n          filtered_entity_count\\n          total_group_count\\n          filtered_group_count\\n          group_results\\n          { total_entity_count\\n            group_by_column_value\\n            entity_results\\n              {data\\n                {name\\n                  values\\n                  {values}\\n                }\\n              }\\n            }\\n          } nsSnapshotsQuery :\\n            groups\\n            (param_body:{entity_type:\\\"entity_backup\\\",group_member_attributes:[{attribute:\\\"hf_snap_intvl_end_times_list\\\"},{attribute:\\\"entity_uuid\\\"}],grouping_attribute:\\\"entity_uuid\\\",filter_criteria:\\\"$uuid\\\"})\\n            { entity_type\\n          total_entity_count\\n          filtered_entity_count\\n          total_group_count\\n          filtered_group_count\\n          group_results\\n          { total_entity_count\\n            group_by_column_value\\n            entity_results\\n              {data\\n                {name\\n                  values\\n                  {values}\\n                }\\n              }\\n            }\\n          } }\"}"
headers = {
  'Content-Type': 'application/json',
}

response = requests.request("POST", url, auth=HTTPBasicAuth('admin', 'nx2Tech254!'), headers=headers, data=payload, verify=False)
json_object = json.loads(response.text)

print(json_object['data']['latestRecoveryPointQuery']['group_results'][0]['entity_results'][0]['data'][4])
print(json_object['data']['latestRecoveryPointQuery']['group_results'][0]['entity_results'][0]['data'][3])

print(json_object['data']['latestRecoveryPointQuery']['group_results'][1]['entity_results'][0]['data'][4])
print(json_object['data']['latestRecoveryPointQuery']['group_results'][1]['entity_results'][0]['data'][3])

print(json_object['data']['latestRecoveryPointQuery']['group_results'][2]['entity_results'][0]['data'][4])
print(json_object['data']['latestRecoveryPointQuery']['group_results'][2]['entity_results'][0]['data'][3])